function PayCtrl($scope){$.get(ROOT+"/pay-api/merchant_new.php",{type:"get_merchants"},function(data){var pageHash=getCurrentSubstrHash();if($scope.$apply(function(){$scope.items=JSON.parse(data),$scope.setHashByOpen=function(element){var currentHash=getCurrentSubstrHash(),currentUrl=window.location.pathname;!currentHash||currentHash!==PAYMENT_MODAL[element]||currentHash!==PAYMENT_MODAL[element]&&!payFix?(setUrlHash(element),payFix=!1):payFix&&(window.history.replaceState(null,null,currentUrl),setUrlHash(element),payFix=!1),currentModal=$('[data-payment-surface="'+currentHash+'"]')};for(var i=0,len=$scope.items.length;i<len;i+=1)$scope.items[i].image=$scope.items[i].image||"no-image",$scope.items[i].paymentName=transliter($scope.items[i].name),PAYMENT_MODAL[$scope.items[i].paymentName]=$scope.items[i].paymentName;payFix=PAYMENT_MODAL[getCurrentSubstrHash()]}),PAYMENT_MODAL[pageHash]){var modalButton=$('[data-payment-name="'+PAYMENT_MODAL[pageHash]+'"]')[0];openModalByHash(modalButton)}})}function getPayItem(self,isself){isself||(self=$(self).data("id")),$.get(ROOT+"/pay-api/merchant_new.php",{type:"merchant_by_id",id:self},function(data){data=JSON.parse(data);var innerData="";$loading.animate({opacity:0},{display:"none"}),data.length?($.each(data,function(index,val){var name=val.terminal_name||"",image=val.image||"no-image",description=val.dsc||"",widjetId=val.widget_id;innerData+='<div class="content"><div id="mk" class="block active"><div class="var"><div class="row"><div class="small-12 column"><h1 class="item-name">'+name+'</h1></div></div><div class="row"><div class="small-3 column small-image" style="background-image: url(images/logo/'+image+'.png);background-repeat: no-repeat;background-size: inherit;background-position-x: 50%;background-position-y: 52%;"></div><div class="small-12 medium-9 column"><p class="item-description">'+description+'</p></div></div></div></div></div><div class="content"><div id="mk" class="block active"><div class="var"><div class="row"><div class="small-12 column widget-container"><div id="arsenalpay-widget-'+widjetId+'"></div></div></div></div></div></div>'}),$innerModalContainer.html(innerData),addWidget(data),$surface.foundation("reveal","open")):appendWarning($innerModalContainer)})}function addWidget(data){"use strict";var widgetList=data.map(function(el){return{widget:"arsenalpay-widget-"+el.widget_id,id:el.widget_id,destination:el.destination?el.destination:""}}),APWidget=[];$.each(widgetList,function(index,el){APWidget[index]=new ArsenalpayWidget({element:el.widget,widget:el.id,destination:el.destination}),APWidget[index].render(center)})}function appendWarning(elem){elem.html('<div class="content"><div id="mk" class="block active"><div class="var"><div class="row"><div class="small-12 column"><h1 class="item-name warning-text">Страницы оплаты с данным id не существует</h1></div></div><div class="row"><div class="small-12 medium-9 column"><p class="item-description">Оплата по данному id недоступна.<br>Пожалуйста, обратитесь за помощью к администрации сайта.<br>Назначение платежа не определено.</p></div></div></div></div></div>')}function transliter(text){for(var tempText=cleanText(text),result="",curSymbol="",translit={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"e","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"-","ы":"y","ь":"i","э":"e","ю":"yu","я":"ya"," ":"-",_:"-","`":"-","~":"-","!":"-","@":"-","#":"-",$:"-","%":"-","^":"-","&":"-","*":"-","(":"-",")":"-","-":"-","=":"-","+":"-","[":"-","]":"-","\\":"-","|":"-","/":"-",".":"-",",":"-","{":"-","}":"-","'":"-",'"':"-",";":"-",":":"-","?":"-","<":"-",">":"-","№":"-"},i=0,len=tempText.length;i<len;i+=1)translit[tempText[i]]?curSymbol===translit[tempText[i]]&&"-"===curSymbol||(result+=translit[tempText[i]],curSymbol=translit[tempText[i]]):(result+=tempText[i],curSymbol=tempText[i]);return result}function center(){setTimeout(function(){var elem=$("#surface"),windowHeight=$(window).height(),modalHeight=elem.outerHeight(),windowScroll=$(window).scrollTop(),topPosition=Math.max(0,(windowHeight-modalHeight)/2+windowScroll)+"px",windowWidth=$(window).width(),appWidth=elem.outerWidth(),leftScroll=$(window).scrollLeft(),centerPos=Math.max(0,(windowWidth-appWidth)/2+leftScroll)+"px",top="";top=windowHeight>modalHeight?topPosition:windowScroll,elem.css("position","absolute"),elem.css("top",top),elem.css("left",centerPos)},0)}function cleanText(text){for(var resultText="",prevSymbol="",i=0,len=text.length;i<len;i+=1)/[^A-zА-я0-9 \.]/.test(text[i])||(text[i]===text[i].toUpperCase()&&prevSymbol===prevSymbol.toLowerCase()&&i>0&&i<len-1&&(resultText+=" "),resultText+=text[i].toLowerCase(),prevSymbol=text[i]);return resultText}var $surface=$("#surface"),$loading=$("#loading"),$innerModalContainer=$("#out"),ROOT="https://test.arsenalpay.ru";ROOT="https://arsenalpay.ru",$(window).on("hashchange",function(){var currentHash=getCurrentSubstrHash(),paymentModal=$("data-payment-surface",getCurrentSubstrHash());currentHash&&!paymentModal.length&&PAYMENT_MODAL[currentHash]&&$surface.attr("data-payment-surface",getCurrentSubstrHash())});